import{_ as G,u as O,r as h,g as j,o as Z,a as r,i as q,b as w,c as T,d as u,e as t,w as l,j as g,E as A,f as p,k as H,l as I,t as z}from"./index-523b1615.js";import{s as E}from"./request-a0feafd1.js";const K={name:"TestCaseSet",setup(){const L=O(),o=h(!1),k=h([]),a=h(!1),U=h(),v=h(),_=j({current:1,size:10,total:0}),s=j({file:null,description:""}),m={file:[{required:!0,message:"请选择文件",trigger:"change"}]},x=e=>{if(e===0)return"0 B";const i=1024,c=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(i));return parseFloat((e/Math.pow(i,n)).toFixed(2))+" "+c[n]},y=e=>{if(!e)return"";try{const i=new URL(e);return`${i.hostname}:${i.port}${i.pathname}`}catch{return e}},d=async e=>{try{await navigator.clipboard.writeText(e),g.success("URL已复制到剪贴板")}catch{const c=document.createElement("textarea");c.value=e,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c),g.success("URL已复制到剪贴板")}},f=async()=>{o.value=!0;try{const e={current:_.current,size:_.size},i=await E({url:"/test-case-set/page",method:"get",params:e});k.value=i.data.records,_.total=i.data.total}catch(e){console.error("加载数据失败:",e)}finally{o.value=!1}},D=()=>{a.value=!0,b()},F=e=>{s.file=e.raw},V=e=>e.type==="application/zip"||e.name.endsWith(".zip")?(e.name.replace(".zip","").split("_").length<2&&g.error("文件名格式错误，应为：用例集名称_版本.zip"),!1):(g.error("只能上传zip文件!"),!1),S=async()=>{try{await U.value.validate();const e=new FormData;e.append("file",s.file),e.append("description",s.description),await E({url:"/test-case-set/upload",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}}),g.success("上传成功"),a.value=!1,f()}catch(e){console.error("上传失败:",e)}},B=async e=>{try{await A.confirm("确定要删除这个用例集吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E({url:`/test-case-set/${e.id}`,method:"delete"}),g.success("删除成功"),f()}catch(i){i!=="cancel"&&g.error("删除失败")}},b=()=>{Object.assign(s,{file:null,description:""}),v.value&&v.value.clearFiles()},R=e=>{_.size=e,f()},C=e=>{_.current=e,f()},M=e=>{L.push(`/test-case-set/detail/${e.id}`)};return Z(()=>{f()}),{loading:o,tableData:k,pagination:_,uploadDialogVisible:a,uploadFormRef:U,uploadRef:v,uploadForm:s,uploadRules:m,formatFileSize:x,getShortUrl:y,copyUrl:d,loadData:f,handleUpload:D,handleFileChange:F,beforeUpload:V,submitUpload:S,handleDelete:B,resetUploadForm:b,handleSizeChange:R,handleCurrentChange:C,handleViewDetail:M}}},P={class:"test-case-set-page"},W={class:"table-operations"},J={key:0},Q={key:1,style:{color:"#909399"}},X={class:"pagination"},Y={class:"dialog-footer"};function $(L,o,k,a,U,v){const _=r("Upload"),s=r("el-icon"),m=r("el-button"),x=r("Refresh"),y=r("el-link"),d=r("el-table-column"),f=r("Link"),D=r("CopyDocument"),F=r("el-tag"),V=r("el-table"),S=r("el-pagination"),B=r("el-card"),b=r("upload-filled"),R=r("el-upload"),C=r("el-form-item"),M=r("el-input"),e=r("el-form"),i=r("el-dialog"),c=q("loading");return w(),T("div",P,[o[12]||(o[12]=u("div",{class:"page-header"},[u("h2",{class:"page-title"},"用例集管理"),u("p",{class:"page-description"},"管理用例集，支持zip文件上传")],-1)),t(B,null,{default:l(()=>[u("div",W,[t(m,{type:"primary",onClick:a.handleUpload},{default:l(()=>[t(s,null,{default:l(()=>[t(_)]),_:1}),o[5]||(o[5]=p(" 上传用例集 ",-1))]),_:1,__:[5]},8,["onClick"]),t(m,{onClick:a.loadData},{default:l(()=>[t(s,null,{default:l(()=>[t(x)]),_:1}),o[6]||(o[6]=p(" 刷新 ",-1))]),_:1,__:[6]},8,["onClick"])]),H((w(),I(V,{data:a.tableData,style:{width:"100%"}},{default:l(()=>[t(d,{prop:"name",label:"用例集名称","min-width":"150"},{default:l(n=>[t(y,{type:"primary",onClick:N=>a.handleViewDetail(n.row),underline:!1},{default:l(()=>[p(z(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),t(d,{prop:"version",label:"版本"}),t(d,{prop:"fileSize",label:"文件大小"},{default:l(n=>[p(z(a.formatFileSize(n.row.fileSize)),1)]),_:1}),t(d,{prop:"description",label:"描述"}),t(d,{label:"GoHttpServer地址","min-width":"200"},{default:l(n=>[n.row.gohttpserverUrl?(w(),T("div",J,[t(y,{type:"primary",href:n.row.gohttpserverUrl,target:"_blank",underline:!1},{default:l(()=>[t(s,null,{default:l(()=>[t(f)]),_:1}),p(" "+z(a.getShortUrl(n.row.gohttpserverUrl)),1)]),_:2},1032,["href"]),t(m,{size:"small",type:"text",onClick:N=>a.copyUrl(n.row.gohttpserverUrl),style:{"margin-left":"8px"}},{default:l(()=>[t(s,null,{default:l(()=>[t(D)]),_:1})]),_:2},1032,["onClick"])])):(w(),T("span",Q,"未上传"))]),_:1}),t(d,{prop:"status",label:"状态"},{default:l(n=>[t(F,{type:n.row.status===1?"success":"danger"},{default:l(()=>[p(z(n.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"createTime",label:"创建时间"}),t(d,{label:"操作",width:"120"},{default:l(n=>[t(m,{size:"small",type:"danger",onClick:N=>a.handleDelete(n.row)},{default:l(()=>o[7]||(o[7]=[p("删除",-1)])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[c,a.loading]]),u("div",X,[t(S,{"current-page":a.pagination.current,"onUpdate:currentPage":o[0]||(o[0]=n=>a.pagination.current=n),"page-size":a.pagination.size,"onUpdate:pageSize":o[1]||(o[1]=n=>a.pagination.size=n),"page-sizes":[10,20,50,100],total:a.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),t(i,{modelValue:a.uploadDialogVisible,"onUpdate:modelValue":o[4]||(o[4]=n=>a.uploadDialogVisible=n),title:"上传用例集",width:"500px"},{footer:l(()=>[u("span",Y,[t(m,{onClick:o[3]||(o[3]=n=>a.uploadDialogVisible=!1)},{default:l(()=>o[10]||(o[10]=[p("取消",-1)])),_:1,__:[10]}),t(m,{type:"primary",onClick:a.submitUpload},{default:l(()=>o[11]||(o[11]=[p("确定",-1)])),_:1,__:[11]},8,["onClick"])])]),default:l(()=>[t(e,{ref:"uploadFormRef",model:a.uploadForm,rules:a.uploadRules,"label-width":"100px"},{default:l(()=>[t(C,{label:"用例集文件",prop:"file"},{default:l(()=>[t(R,{ref:"uploadRef","auto-upload":!1,"on-change":a.handleFileChange,"before-upload":a.beforeUpload,accept:".zip",drag:""},{tip:l(()=>o[8]||(o[8]=[u("div",{class:"el-upload__tip"}," 只能上传zip文件，且文件名格式为：用例集名称_版本.zip ",-1)])),default:l(()=>[t(s,{class:"el-icon--upload"},{default:l(()=>[t(b)]),_:1}),o[9]||(o[9]=u("div",{class:"el-upload__text"},[p(" 将文件拖到此处，或"),u("em",null,"点击上传")],-1))]),_:1,__:[9]},8,["on-change","before-upload"])]),_:1}),t(C,{label:"描述",prop:"description"},{default:l(()=>[t(M,{modelValue:a.uploadForm.description,"onUpdate:modelValue":o[2]||(o[2]=n=>a.uploadForm.description=n),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const oe=G(K,[["render",$],["__scopeId","data-v-3ba87c94"]]);export{oe as default};
