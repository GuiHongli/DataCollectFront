import{s as k}from"./request-a0feafd1.js";import{_ as Xe,r as y,g as ne,h as Ye,o as Ze,q as $e,a as f,i as et,b as d,c as _,d as r,e as a,w as s,n as A,j as D,E as tt,f as g,k as de,l as T,t as c,F as O,m as U,s as nt}from"./index-523b1615.js";const lt={name:"CollectTask",setup(){const Y=y(!1),l=y(!1),X=y([]),t=y(!1),le=y(""),Z=y(!1),S=y([]),F=y("");y(new Map);const h=y(),G=y(),p=y(),x=y([]),q=y([]),z=y([]),M=y([]),b=y([]),P=y(null),C=y([]),B=y(!1),w=y([]),E=ne({current:1,size:10,total:0}),I=ne({name:"",description:""}),$={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},H=ne({strategyId:null}),oe={strategyId:[{required:!0,message:"请选择采集策略",trigger:"change"}]},u=ne({regionId:null,countryId:null,provinceId:null,cityId:null}),ae={regionId:[{required:!0,message:"请选择地域",trigger:"change"}]},N=()=>w.value.length===0?(D.error("请至少选择一个逻辑环境"),!1):!0,ee=e=>({PENDING:"info",RUNNING:"success",COMPLETED:"success",STOPPED:"info",PAUSED:"warning"})[e]||"info",se=e=>({PENDING:"待执行",RUNNING:"运行中",COMPLETED:"已完成",STOPPED:"已停止",PAUSED:"已暂停",FAILED:"已停止"})[e]||"未知",re=e=>{const o=e.totalCount||0,i=e.completedCount||0,m=e.successCount||0,V=e.failedCount||0,R=e.blockedCount||0,te=e.runningCount||0;if(o===0)return"暂无数据";const W=[];return m>0&&W.push(`${m}成功`),V>0&&W.push(`${V}失败`),R>0&&W.push(`${R}阻塞`),te>0&&W.push(`${te}执行中`),`${i}/${o} (${W.join(", ")})`},j=e=>{const o=e.totalCount||0,i=e.completedCount||0;return o===0?0:Math.round(i/o*100)},n=e=>j(e)===100?"success":e.status==="RUNNING"?"warning":"",v=e=>j(e)===100?"#67c23a":e.status==="RUNNING"?"#e6a23c":"#409eff",ce=Ye(()=>{const e=[];if(u.regionId){const o=q.value.find(i=>i.id===u.regionId);o&&e.push(o.name)}if(u.countryId){const o=z.value.find(i=>i.id===u.countryId);o&&e.push(o.name)}if(u.provinceId){const o=M.value.find(i=>i.id===u.provinceId);o&&e.push(o.name)}if(u.cityId){const o=b.value.find(i=>i.id===u.cityId);o&&e.push(o.name)}return e.length>0?e.join(" / "):"未配置环境"}),K=async()=>{Y.value=!0;try{const e={current:E.current,size:E.size},o=await k({url:"/collect-task/page",method:"get",params:e});X.value=o.data.records,E.total=o.data.total,await ie()}catch(e){console.error("加载数据失败:",e)}finally{Y.value=!1}},ie=async()=>{try{const e=X.value.map(async o=>{try{const m=(await k({url:`/collect-task/${o.id}/execution-instances`,method:"get"})).data||[],V=m.length,R=m.filter(L=>L.result==="SUCCESS").length,te=m.filter(L=>L.result==="FAILED").length,W=m.filter(L=>L.result==="BLOCKED").length,Qe=m.filter(L=>L.status==="RUNNING").length,We=m.filter(L=>L.status!=="RUNNING").length;o.totalCount=V,o.successCount=R,o.failedCount=te,o.runningCount=Qe,o.completedCount=We}catch(i){console.error(`加载任务 ${o.id} 执行状态失败:`,i),o.totalCount=0,o.successCount=0,o.failedCount=0,o.runningCount=0,o.completedCount=0}});await Promise.all(e)}catch(e){console.error("加载任务执行状态失败:",e)}},be=async()=>{l.value=!0;try{await ie(),D.success("执行状态刷新成功")}catch(e){console.error("刷新执行状态失败:",e),D.error("刷新执行状态失败")}finally{l.value=!1}},ue=async()=>{try{const e=await k({url:"/collect-strategy/list",method:"get"});x.value=e.data}catch(e){console.error("加载策略数据失败:",e)}},ge=async()=>{try{const e=await k({url:"/region/list",method:"get"});q.value=e.data.filter(o=>o.level===1)}catch(e){console.error("加载地域数据失败:",e)}},me=async e=>{try{const o=await k({url:`/region/parent/${e}`,method:"get"});z.value=o.data.filter(i=>i.level===2)}catch(o){console.error("加载国家数据失败:",o)}},ve=async e=>{try{const o=await k({url:`/region/parent/${e}`,method:"get"});M.value=o.data.filter(i=>i.level===3)}catch(o){console.error("加载省份数据失败:",o)}},fe=async e=>{try{const o=await k({url:`/region/parent/${e}`,method:"get"});b.value=o.data.filter(i=>i.level===4)}catch(o){console.error("加载城市数据失败:",o)}},J=async()=>{if(!P.value||!u.regionId&&!u.countryId&&!u.provinceId&&!u.cityId){C.value=[];return}B.value=!0;try{const e={strategyId:P.value.id,regionId:u.regionId,countryId:u.countryId,provinceId:u.provinceId,cityId:u.cityId},o=await k({url:"/collect-task/available-logic-environments",method:"get",params:e});C.value=o.data}catch(e){console.error("加载可用逻辑环境失败:",e),C.value=[]}finally{B.value=!1}},Ce=()=>{le.value="新建采集任务",t.value=!0,pe(),ge()},Ie=async e=>{if(e){const o=x.value.find(i=>i.id===e);o&&(P.value=o,await J())}else P.value=null,C.value=[]},we=async e=>{u.countryId=null,u.provinceId=null,u.cityId=null,z.value=[],M.value=[],b.value=[],e&&await me(e),await J()},ke=async e=>{u.provinceId=null,u.cityId=null,M.value=[],b.value=[],e&&await ve(e),await J()},Te=async e=>{u.cityId=null,b.value=[],e&&await fe(e),await J()},Se=async()=>{await J()},Ee=e=>{const o=w.value.indexOf(e);o>-1?w.value.splice(o,1):w.value.push(e)},xe=()=>{},Pe=async e=>{try{await k({url:`/collect-task/${e.id}/stop`,method:"post"}),D.success("停止成功"),K()}catch{D.error("停止失败")}},De=async e=>{try{await tt.confirm("确定要删除这个任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k({url:`/collect-task/${e.id}`,method:"delete"}),D.success("删除成功"),K()}catch(o){o!=="cancel"&&D.error("删除失败")}},Fe=async()=>{Z.value=!0;try{if(await Promise.all([h.value.validate(),G.value.validate(),p.value.validate()]),!N())return;const e={name:I.name,description:I.description,collectStrategyId:H.strategyId,collectCount:P.value?P.value.collectCount:1,regionId:u.regionId,countryId:u.countryId,provinceId:u.provinceId,cityId:u.cityId,logicEnvironmentIds:w.value};await k({url:"/collect-task/create",method:"post",data:e}),D.success("任务创建成功"),t.value=!1,K()}catch(e){console.error("提交失败:",e),e.message?D.error(e.message):D.error("任务创建失败")}finally{Z.value=!1}},pe=()=>{Object.assign(I,{name:"",description:""}),Object.assign(H,{strategyId:null}),Object.assign(u,{regionId:null,countryId:null,provinceId:null,cityId:null}),P.value=null,z.value=[],M.value=[],b.value=[],w.value=[],C.value=[],h.value&&h.value.resetFields(),G.value&&G.value.resetFields(),p.value&&p.value.resetFields()},Ne=e=>{E.size=e,K()},Ve=e=>{E.current=e,K()},Re=async e=>{const o=`task-${e.id}`,i=`${e.name} (ID: ${e.id})`;if(S.value.find(R=>R.name===o)){F.value=o;return}const V={name:o,label:i,task:e,progress:{},instances:[],instancesLoading:!1};S.value.push(V),F.value=o,await Ue(o,e.id)},Le=e=>{const o=S.value;let i=F.value;i===e&&o.forEach((m,V)=>{if(m.name===e){const R=o[V+1]||o[V-1];R&&(i=R.name)}}),F.value=i,S.value=o.filter(m=>m.name!==e)},Oe=e=>{F.value=e.name},Ue=async(e,o)=>{S.value.find(m=>m.name===e)&&(await _e(e,o),await ye(e,o))},_e=async(e,o)=>{const i=S.value.find(m=>m.name===e);if(i)try{const m=await k({url:`/collect-task/${o}/progress`,method:"get"});i.progress=m.data}catch(m){console.error("加载任务进度失败:",m),i.progress={}}},ye=async(e,o)=>{const i=S.value.find(m=>m.name===e);if(i){i.instancesLoading=!0;try{const m=await k({url:`/collect-task/${o}/execution-instances`,method:"get"});i.instances=m.data}catch(m){console.error("加载执行例次失败:",m),i.instances=[]}finally{i.instancesLoading=!1}}},ze=async e=>{const o=S.value.find(i=>i.name===e);o&&await _e(e,o.task.id)},Me=async e=>{const o=S.value.find(i=>i.name===e);o&&await ye(e,o.task.id)},he=e=>{const o=(e==null?void 0:e.totalCount)||0,i=((e==null?void 0:e.successCount)||0)+((e==null?void 0:e.failedCount)||0)+((e==null?void 0:e.blockedCount)||0);return o>0?Math.round(i/o*100):0},Ae=e=>he(e)===100?"success":"",Ge=e=>({PENDING:"info",RUNNING:"warning",COMPLETED:"success",FAILED:"danger",STOPPED:"info",BLOCKED:"warning"})[e]||"info",Be=e=>({PENDING:"待执行",RUNNING:"执行中",COMPLETED:"已完成",FAILED:"执行失败",STOPPED:"已停止",BLOCKED:"阻塞"})[e]||"阻塞",je=e=>({SUCCESS:"success",FAILED:"danger",BLOCKED:"warning"})[e]||"info",Ke=e=>({SUCCESS:"成功",FAILED:"失败",BLOCKED:"阻塞"})[e]||"阻塞",qe=e=>{D.info(`查看用例 ${e.testCaseNumber} 第 ${e.round} 轮执行详情，执行任务ID: ${e.executionTaskId}`)};let Q=null;const He=()=>{Q&&clearInterval(Q),Q=setInterval(async()=>{X.value.some(o=>o.status==="RUNNING")&&await ie()},3e4)},Je=()=>{Q&&(clearInterval(Q),Q=null)};return Ze(()=>{K(),ue(),He()}),$e(()=>{Je()}),{loading:Y,statusLoading:l,tableData:X,pagination:E,dialogVisible:t,dialogTitle:le,submitLoading:Z,basicFormRef:h,strategyFormRef:G,environmentFormRef:p,basicForm:I,basicRules:$,strategyForm:H,strategyRules:oe,environmentForm:u,environmentRules:ae,strategyOptions:x,regionOptions:q,countryOptions:z,provinceOptions:M,cityOptions:b,selectedStrategy:P,availableEnvironments:C,environmentsLoading:B,selectedEnvironmentIds:w,environmentSummary:ce,getStatusType:ee,getStatusText:se,getTableProgressText:re,getTableProgressPercentage:j,getTableProgressStatus:n,getProgressColor:v,loadData:K,loadStrategyOptions:ue,loadRegionOptions:ge,loadCountryOptions:me,loadProvinceOptions:ve,loadCityOptions:fe,handleAdd:Ce,handleStop:Pe,handleDelete:De,handleSubmit:Fe,resetForm:pe,handleStrategyChange:Ie,handleRegionChange:we,handleCountryChange:ke,handleProvinceChange:Te,handleCityChange:Se,loadAvailableEnvironments:J,toggleEnvironmentSelection:Ee,handleEnvironmentSelection:xe,handleSizeChange:Ne,handleCurrentChange:Ve,refreshExecutionStatus:be,activeTabs:S,activeTabName:F,handleViewDetail:Re,removeTab:Le,handleTabClick:Oe,refreshTaskProgress:ze,refreshExecutionInstances:Me,getProgressPercentage:he,getProgressStatus:Ae,getInstanceStatusType:Ge,getInstanceStatusText:Be,getInstanceResultType:je,getInstanceResultText:Ke,viewInstanceResult:qe}}},ot={class:"collect-task-page"},at={class:"table-operations"},st={class:"progress-display"},rt={class:"progress-info"},it={class:"progress-text"},dt={class:"progress-percentage"},ct={class:"pagination"},ut={class:"step-content"},gt={class:"step-panel"},mt={class:"step-panel"},vt={key:0,class:"strategy-info"},ft={class:"step-panel"},pt={class:"environment-summary"},_t={key:0,class:"available-environments"},yt={class:"environments-content"},ht={key:0,class:"no-environments"},bt={key:1,class:"environments-list"},Ct={class:"environment-header"},It={class:"environment-name"},wt={class:"environment-status"},kt={class:"environment-info"},Tt={key:0},St={key:0,class:"environment-ue"},Et={class:"ue-list"},xt={key:1,class:"environment-networks"},Pt={class:"network-list"},Dt={key:0,class:"selection-tip"},Ft={class:"dialog-footer"},Nt={key:0,class:"task-detail-tabs"},Vt={key:0,class:"task-detail"},Rt={class:"card-header"},Lt={class:"progress-section"},Ot={class:"progress-overview"},Ut={class:"progress-item"},zt={class:"progress-number"},Mt={class:"progress-item"},At={class:"progress-number success"},Gt={class:"progress-item"},Bt={class:"progress-number warning"},jt={class:"progress-item"},Kt={class:"progress-number info"},qt={class:"progress-bar-section"},Ht={class:"progress-bar-label"},Jt={class:"statistics-section"},Qt={class:"stat-card success"},Wt={class:"stat-content"},Xt={class:"stat-number"},Yt={class:"stat-card warning"},Zt={class:"stat-content"},$t={class:"stat-number"},en={class:"stat-card info"},tn={class:"stat-content"},nn={class:"stat-number"},ln={class:"card-header"},on={class:"instances-section"},an={key:1},sn={key:1};function rn(Y,l,X,t,le,Z){const S=f("Plus"),F=f("el-icon"),h=f("el-button"),G=f("Refresh"),p=f("el-table-column"),x=f("el-tag"),q=f("el-progress"),z=f("el-table"),M=f("el-pagination"),b=f("el-card"),P=f("el-input"),C=f("el-form-item"),B=f("el-form"),w=f("el-option"),E=f("el-select"),I=f("el-descriptions-item"),$=f("el-descriptions"),H=f("el-alert"),oe=f("el-empty"),u=f("el-checkbox"),ae=f("el-dialog"),N=f("el-col"),ee=f("el-row"),se=f("el-tab-pane"),re=f("el-tabs"),j=et("loading");return d(),_("div",ot,[l[48]||(l[48]=r("div",{class:"page-header"},[r("h2",{class:"page-title"},"采集任务管理"),r("p",{class:"page-description"},"管理采集任务，支持任务的停止、删除等操作")],-1)),a(b,null,{default:s(()=>[r("div",at,[a(h,{type:"primary",onClick:t.handleAdd},{default:s(()=>[a(F,null,{default:s(()=>[a(S)]),_:1}),l[13]||(l[13]=g(" 新增任务 ",-1))]),_:1,__:[13]},8,["onClick"]),a(h,{onClick:t.loadData},{default:s(()=>[a(F,null,{default:s(()=>[a(G)]),_:1}),l[14]||(l[14]=g(" 刷新 ",-1))]),_:1,__:[14]},8,["onClick"]),a(h,{onClick:t.refreshExecutionStatus,loading:t.statusLoading},{default:s(()=>[a(F,null,{default:s(()=>[a(G)]),_:1}),l[15]||(l[15]=g(" 刷新执行状态 ",-1))]),_:1,__:[15]},8,["onClick","loading"])]),de((d(),T(z,{data:t.tableData,style:{width:"100%"}},{default:s(()=>[a(p,{prop:"id",label:"任务ID",width:"80"}),a(p,{prop:"name",label:"任务名称"},{default:s(n=>[a(h,{type:"text",onClick:v=>t.handleViewDetail(n.row),style:{color:"#409eff","text-decoration":"none"}},{default:s(()=>[g(c(n.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(p,{prop:"status",label:"状态"},{default:s(n=>[a(x,{type:t.getStatusType(n.row.status)},{default:s(()=>[g(c(t.getStatusText(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(p,{label:"执行进度",width:"200"},{default:s(n=>[r("div",st,[r("div",rt,[r("span",it,c(t.getTableProgressText(n.row)),1),r("span",dt,c(t.getTableProgressPercentage(n.row))+"%",1)]),a(q,{percentage:t.getTableProgressPercentage(n.row),status:t.getTableProgressStatus(n.row),"stroke-width":8,"show-text":!1,color:t.getProgressColor(n.row)},null,8,["percentage","status","color"])])]),_:1}),a(p,{prop:"createTime",label:"创建时间"}),a(p,{label:"操作",width:"150"},{default:s(n=>[a(h,{size:"small",type:"danger",onClick:v=>t.handleStop(n.row),disabled:n.row.status==="STOPPED"||n.row.status==="COMPLETED"},{default:s(()=>l[16]||(l[16]=[g(" 停止 ",-1)])),_:2,__:[16]},1032,["onClick","disabled"]),a(h,{size:"small",type:"danger",onClick:v=>t.handleDelete(n.row)},{default:s(()=>l[17]||(l[17]=[g("删除",-1)])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,t.loading]]),r("div",ct,[a(M,{"current-page":t.pagination.current,"onUpdate:currentPage":l[0]||(l[0]=n=>t.pagination.current=n),"page-size":t.pagination.size,"onUpdate:pageSize":l[1]||(l[1]=n=>t.pagination.size=n),"page-sizes":[10,20,50,100],total:t.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),a(ae,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[11]||(l[11]=n=>t.dialogVisible=n),title:t.dialogTitle,width:"800px",onClose:t.resetForm},{footer:s(()=>[r("span",Ft,[a(h,{onClick:l[10]||(l[10]=n=>t.dialogVisible=!1)},{default:s(()=>l[29]||(l[29]=[g("取消",-1)])),_:1,__:[29]}),a(h,{type:"success",onClick:t.handleSubmit,loading:t.submitLoading},{default:s(()=>l[30]||(l[30]=[g(" 创建任务 ",-1)])),_:1,__:[30]},8,["onClick","loading"])])]),default:s(()=>[r("div",ut,[r("div",gt,[l[18]||(l[18]=r("h3",{class:"step-title"},"基本信息",-1)),a(B,{ref:"basicFormRef",model:t.basicForm,rules:t.basicRules,"label-width":"120px"},{default:s(()=>[a(C,{label:"任务名称",prop:"name"},{default:s(()=>[a(P,{modelValue:t.basicForm.name,"onUpdate:modelValue":l[2]||(l[2]=n=>t.basicForm.name=n),placeholder:"请输入采集任务名称"},null,8,["modelValue"])]),_:1}),a(C,{label:"任务描述",prop:"description"},{default:s(()=>[a(P,{modelValue:t.basicForm.description,"onUpdate:modelValue":l[3]||(l[3]=n=>t.basicForm.description=n),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),r("div",mt,[l[20]||(l[20]=r("h3",{class:"step-title"},"采集策略",-1)),a(B,{ref:"strategyFormRef",model:t.strategyForm,rules:t.strategyRules,"label-width":"120px"},{default:s(()=>[a(C,{label:"采集策略",prop:"strategyId"},{default:s(()=>[a(E,{modelValue:t.strategyForm.strategyId,"onUpdate:modelValue":l[4]||(l[4]=n=>t.strategyForm.strategyId=n),placeholder:"请选择采集策略",style:{width:"100%"},onChange:t.handleStrategyChange},{default:s(()=>[(d(!0),_(O,null,U(t.strategyOptions,n=>(d(),T(w,{key:n.id,label:`${n.name} (${n.collectCount}次采集)`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t.selectedStrategy?(d(),_("div",vt,[l[19]||(l[19]=r("h4",null,"策略详情",-1)),a($,{column:1,border:"",size:"small"},{default:s(()=>[a(I,{label:"策略名称"},{default:s(()=>[g(c(t.selectedStrategy.name),1)]),_:1}),a(I,{label:"采集次数"},{default:s(()=>[g(c(t.selectedStrategy.collectCount)+"次",1)]),_:1}),a(I,{label:"关联用例集"},{default:s(()=>[g(c(t.selectedStrategy.testCaseSetName)+" ("+c(t.selectedStrategy.testCaseSetVersion)+")",1)]),_:1}),a(I,{label:"测试用例数量"},{default:s(()=>[g(c(t.selectedStrategy.testCaseList?t.selectedStrategy.testCaseList.length:0)+"个",1)]),_:1})]),_:1})])):A("",!0)]),_:1},8,["model","rules"])]),r("div",ft,[l[28]||(l[28]=r("h3",{class:"step-title"},"环境编排",-1)),a(B,{ref:"environmentFormRef",model:t.environmentForm,rules:t.environmentRules,"label-width":"120px"},{default:s(()=>[a(C,{label:"地域筛选",prop:"regionId"},{default:s(()=>[a(E,{modelValue:t.environmentForm.regionId,"onUpdate:modelValue":l[5]||(l[5]=n=>t.environmentForm.regionId=n),placeholder:"请选择地域",style:{width:"100%"},onChange:t.handleRegionChange},{default:s(()=>[(d(!0),_(O,null,U(t.regionOptions,n=>(d(),T(w,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),a(C,{label:"国家筛选",prop:"countryId"},{default:s(()=>[a(E,{modelValue:t.environmentForm.countryId,"onUpdate:modelValue":l[6]||(l[6]=n=>t.environmentForm.countryId=n),placeholder:"请选择国家",style:{width:"100%"},onChange:t.handleCountryChange,disabled:!t.environmentForm.regionId},{default:s(()=>[(d(!0),_(O,null,U(t.countryOptions,n=>(d(),T(w,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),a(C,{label:"省份筛选",prop:"provinceId"},{default:s(()=>[a(E,{modelValue:t.environmentForm.provinceId,"onUpdate:modelValue":l[7]||(l[7]=n=>t.environmentForm.provinceId=n),placeholder:"请选择省份",style:{width:"100%"},onChange:t.handleProvinceChange,disabled:!t.environmentForm.countryId},{default:s(()=>[(d(!0),_(O,null,U(t.provinceOptions,n=>(d(),T(w,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),a(C,{label:"城市筛选",prop:"cityId"},{default:s(()=>[a(E,{modelValue:t.environmentForm.cityId,"onUpdate:modelValue":l[8]||(l[8]=n=>t.environmentForm.cityId=n),placeholder:"请选择城市",style:{width:"100%"},onChange:t.handleCityChange,disabled:!t.environmentForm.provinceId},{default:s(()=>[(d(!0),_(O,null,U(t.cityOptions,n=>(d(),T(w,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),r("div",pt,[l[21]||(l[21]=r("h4",null,"环境配置摘要",-1)),a(H,{title:t.environmentSummary,type:"info",closable:!1,"show-icon":""},null,8,["title"])])]),_:1},8,["model","rules"]),t.selectedStrategy&&(t.environmentForm.regionId||t.environmentForm.countryId||t.environmentForm.provinceId||t.environmentForm.cityId)?(d(),_("div",_t,[l[27]||(l[27]=r("h4",null,"可用逻辑环境列表",-1)),de((d(),_("div",yt,[t.availableEnvironments.length===0?(d(),_("div",ht,[a(oe,{description:"暂无可用的逻辑环境"})])):(d(),_("div",bt,[(d(!0),_(O,null,U(t.availableEnvironments,n=>(d(),T(b,{key:n.id,class:nt(["environment-card",{selected:t.selectedEnvironmentIds.includes(n.id)}]),shadow:"hover",onClick:v=>t.toggleEnvironmentSelection(n.id)},{default:s(()=>[r("div",Ct,[r("h5",It,c(n.name),1),r("div",wt,[a(x,{type:n.status===1?"success":"danger",size:"small"},{default:s(()=>[g(c(n.status===1?"可用":"不可用"),1)]),_:2},1032,["type"]),a(u,{modelValue:t.selectedEnvironmentIds,"onUpdate:modelValue":l[9]||(l[9]=v=>t.selectedEnvironmentIds=v),value:n.id,onChange:t.handleEnvironmentSelection,style:{"margin-left":"8px"}},null,8,["modelValue","value","onChange"])])]),r("div",kt,[r("p",null,[l[22]||(l[22]=r("strong",null,"执行机：",-1)),g(c(n.executorName)+" ("+c(n.executorIpAddress)+")",1)]),r("p",null,[l[23]||(l[23]=r("strong",null,"地域：",-1)),g(c(n.executorRegionName),1)]),n.description?(d(),_("p",Tt,[l[24]||(l[24]=r("strong",null,"描述：",-1)),g(c(n.description),1)])):A("",!0)]),n.ueList&&n.ueList.length>0?(d(),_("div",St,[l[25]||(l[25]=r("p",null,[r("strong",null,"UE设备：")],-1)),r("div",Et,[(d(!0),_(O,null,U(n.ueList,v=>(d(),T(x,{key:v.id,size:"small",style:{"margin-right":"8px","margin-bottom":"4px"}},{default:s(()=>[g(c(v.name)+" ("+c(v.ueId)+") ",1)]),_:2},1024))),128))])])):A("",!0),n.networkList&&n.networkList.length>0?(d(),_("div",xt,[l[26]||(l[26]=r("p",null,[r("strong",null,"环境组网：")],-1)),r("div",Pt,[(d(!0),_(O,null,U(n.networkList,v=>(d(),T(x,{key:v.id,type:"info",size:"small",style:{"margin-right":"8px","margin-bottom":"4px"}},{default:s(()=>[g(c(v.name),1)]),_:2},1024))),128))])])):A("",!0)]),_:2},1032,["class","onClick"]))),128))]))])),[[j,t.environmentsLoading]]),t.availableEnvironments.length>0?(d(),_("div",Dt,[a(H,{title:`已选择 ${t.selectedEnvironmentIds.length} 个逻辑环境`,type:"info",closable:!1,"show-icon":""},null,8,["title"])])):A("",!0)])):A("",!0)])])]),_:1},8,["modelValue","title","onClose"]),t.activeTabs.length>0?(d(),_("div",Nt,[a(re,{modelValue:t.activeTabName,"onUpdate:modelValue":l[12]||(l[12]=n=>t.activeTabName=n),type:"card",closable:"",onTabRemove:t.removeTab,onTabClick:t.handleTabClick},{default:s(()=>[(d(!0),_(O,null,U(t.activeTabs,n=>(d(),T(se,{key:n.name,label:n.label,name:n.name},{default:s(()=>[n.task?(d(),_("div",Vt,[a(b,{class:"detail-card"},{header:s(()=>l[31]||(l[31]=[r("div",{class:"card-header"},[r("span",null,"基本信息")],-1)])),default:s(()=>[a($,{column:2,border:""},{default:s(()=>[a(I,{label:"任务ID"},{default:s(()=>[g(c(n.task.id),1)]),_:2},1024),a(I,{label:"任务名称"},{default:s(()=>[g(c(n.task.name),1)]),_:2},1024),a(I,{label:"任务状态"},{default:s(()=>[a(x,{type:t.getStatusType(n.task.status)},{default:s(()=>[g(c(t.getStatusText(n.task.status)),1)]),_:2},1032,["type"])]),_:2},1024),a(I,{label:"创建时间"},{default:s(()=>[g(c(n.task.createTime),1)]),_:2},1024),a(I,{label:"任务描述"},{default:s(()=>[g(c(n.task.description||"无"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(b,{class:"detail-card"},{header:s(()=>[r("div",Rt,[l[33]||(l[33]=r("span",null,"执行进度",-1)),a(h,{size:"small",onClick:v=>t.refreshTaskProgress(n.name)},{default:s(()=>l[32]||(l[32]=[g("刷新",-1)])),_:2,__:[32]},1032,["onClick"])])]),default:s(()=>[r("div",Lt,[r("div",Ot,[a(ee,{gutter:20},{default:s(()=>[a(N,{span:6},{default:s(()=>[r("div",Ut,[r("div",zt,c(n.progress.totalCount||0),1),l[34]||(l[34]=r("div",{class:"progress-label"},"总用例数",-1))])]),_:2},1024),a(N,{span:6},{default:s(()=>[r("div",Mt,[r("div",At,c(n.progress.successCount||0),1),l[35]||(l[35]=r("div",{class:"progress-label"},"成功用例数",-1))])]),_:2},1024),a(N,{span:6},{default:s(()=>[r("div",Gt,[r("div",Bt,c(n.progress.failedCount||0),1),l[36]||(l[36]=r("div",{class:"progress-label"},"失败用例数",-1))])]),_:2},1024),a(N,{span:6},{default:s(()=>[r("div",jt,[r("div",Kt,c(n.progress.runningCount||0),1),l[37]||(l[37]=r("div",{class:"progress-label"},"执行中用例数",-1))])]),_:2},1024)]),_:2},1024)]),r("div",qt,[r("div",Ht," 执行进度: "+c(t.getProgressPercentage(n.progress))+"% ",1),a(q,{percentage:t.getProgressPercentage(n.progress),status:t.getProgressStatus(n.progress),"stroke-width":20},null,8,["percentage","status"])])])]),_:2},1024),a(b,{class:"detail-card"},{header:s(()=>l[38]||(l[38]=[r("div",{class:"card-header"},[r("span",null,"执行结果统计")],-1)])),default:s(()=>[r("div",Jt,[a(ee,{gutter:20},{default:s(()=>[a(N,{span:8},{default:s(()=>[r("div",Qt,[l[40]||(l[40]=r("div",{class:"stat-icon"},"✓",-1)),r("div",Wt,[r("div",Xt,c(n.progress.successCount||0),1),l[39]||(l[39]=r("div",{class:"stat-label"},"成功",-1))])])]),_:2},1024),a(N,{span:8},{default:s(()=>[r("div",Yt,[l[42]||(l[42]=r("div",{class:"stat-icon"},"✗",-1)),r("div",Zt,[r("div",$t,c(n.progress.failedCount||0),1),l[41]||(l[41]=r("div",{class:"stat-label"},"失败",-1))])])]),_:2},1024),a(N,{span:8},{default:s(()=>[r("div",en,[l[44]||(l[44]=r("div",{class:"stat-icon"},"⏸",-1)),r("div",tn,[r("div",nn,c(n.progress.runningCount||0),1),l[43]||(l[43]=r("div",{class:"stat-label"},"执行中",-1))])])]),_:2},1024)]),_:2},1024)])]),_:2},1024),a(b,{class:"detail-card"},{header:s(()=>[r("div",ln,[l[46]||(l[46]=r("span",null,"用例例次执行信息",-1)),a(h,{size:"small",onClick:v=>t.refreshExecutionInstances(n.name)},{default:s(()=>l[45]||(l[45]=[g("刷新",-1)])),_:2,__:[45]},1032,["onClick"])])]),default:s(()=>[r("div",on,[de((d(),T(z,{data:n.instances,style:{width:"100%"}},{default:s(()=>[a(p,{prop:"testCaseId",label:"用例ID",width:"100"}),a(p,{prop:"testCaseNumber",label:"用例编号",width:"120"}),a(p,{prop:"testCaseName",label:"用例名称"}),a(p,{prop:"round",label:"轮次",width:"80"}),a(p,{prop:"logicEnvironmentName",label:"逻辑环境",width:"150"}),a(p,{prop:"executorIp",label:"执行机IP",width:"120"}),a(p,{prop:"status",label:"执行状态",width:"100"},{default:s(v=>[a(x,{type:t.getInstanceStatusType(v.row.status)},{default:s(()=>[g(c(t.getInstanceStatusText(v.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"result",label:"执行结果",width:"100"},{default:s(v=>[v.row.result?(d(),T(x,{key:0,type:t.getInstanceResultType(v.row.result)},{default:s(()=>[g(c(t.getInstanceResultText(v.row.result)),1)]),_:2},1032,["type"])):(d(),_("span",an,"-"))]),_:1}),a(p,{prop:"executionTaskId",label:"执行任务ID",width:"200"}),a(p,{prop:"createTime",label:"创建时间",width:"160"}),a(p,{prop:"updateTime",label:"更新时间",width:"160"}),a(p,{label:"操作",width:"120"},{default:s(v=>[v.row.executionTaskId?(d(),T(h,{key:0,type:"text",size:"small",onClick:ce=>t.viewInstanceResult(v.row)},{default:s(()=>l[47]||(l[47]=[g(" 查看详情 ",-1)])),_:2,__:[47]},1032,["onClick"])):(d(),_("span",sn,"-"))]),_:1})]),_:2},1032,["data"])),[[j,n.instancesLoading]])])]),_:2},1024)])):A("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue","onTabRemove","onTabClick"])])):A("",!0)])}const un=Xe(lt,[["render",rn],["__scopeId","data-v-c95014e6"]]);export{un as default};
