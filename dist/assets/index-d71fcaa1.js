import{s as w}from"./request-a0feafd1.js";import{_ as le,r as v,g as L,h as q,o as ae,a as s,i as te,b as p,c as z,d as F,e as a,w as o,E as oe,j as R,f,k as ne,l as k,t as re,F as D,m as S,n as ie}from"./index-523b1615.js";const de={name:"Region",setup(){const i=v(!1),e=v([]),E=v(!1),t=v(""),I=v(),j=v([]),U=v(!1),C=v(),m=v([]),h=v([]),c=v([]),N=v([]),_=L({current:1,size:10,total:0}),y=L({id:null,name:"",level:1,parentId:null,description:"",status:1}),d=L({regionName:"",countryName:"",provinceName:"",cityName:"",status:1}),P={regionName:[{required:!0,message:"请选择或输入地域名称",trigger:"change"}],countryName:[{required:!0,message:"请选择或输入国家名称",trigger:"change"}]},g=n=>({1:"primary",2:"success",3:"warning",4:"info"})[n]||"info",b=n=>({1:"片区",2:"国家",3:"省份",4:"城市"})[n]||"未知",u=async()=>{i.value=!0;try{const n={current:_.current,size:_.size},r=await w({url:"/region/hierarchy",method:"get",params:n});e.value=r.data.records||r.data,_.total=r.data.total||r.data.length}catch(n){console.error("加载数据失败:",n)}finally{i.value=!1}},O=async n=>{if(!(n<=1))try{const r=await w({url:`/region/level/${n-1}`,method:"get"});j.value=r.data}catch(r){console.error("加载上级地域失败:",r)}},B=async()=>{try{const r=(await w({url:"/region/list",method:"get"})).data||[];m.value=r.filter(V=>V.level===1),h.value=r.filter(V=>V.level===2),c.value=r.filter(V=>V.level===3),N.value=r.filter(V=>V.level===4)}catch(n){console.error("加载选项数据失败:",n)}},M=()=>{U.value=!0,G(),B()},T=n=>{d.regionName=n,d.countryName="",d.provinceName="",d.cityName=""},x=n=>{d.countryName=n,d.provinceName="",d.cityName=""},l=n=>{d.provinceName=n,d.cityName=""},A=n=>{d.cityName=n},H=q(()=>{if(!d.regionName)return[];const n=m.value.find(r=>r.name===d.regionName);return n?h.value.filter(r=>r.parentId===n.id):h.value}),J=q(()=>{if(!d.countryName)return[];const n=h.value.find(r=>r.name===d.countryName);return n?c.value.filter(r=>r.parentId===n.id):c.value}),K=q(()=>{if(!d.provinceName)return[];const n=c.value.find(r=>r.name===d.provinceName);return n?N.value.filter(r=>r.parentId===n.id):N.value}),Q=n=>{t.value="编辑地域",Object.assign(y,n),E.value=!0,O(y.level)},W=async n=>{try{await oe.confirm("确定要删除这个地域吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w({url:`/region/${n.id}`,method:"delete"}),R.success("删除成功"),u()}catch(r){r!=="cancel"&&R.error("删除失败")}},X=async()=>{try{await I.value.validate(),y.id?(await w({url:`/region/${y.id}`,method:"put",data:y}),R.success("更新成功")):(await w({url:"/region",method:"post",data:y}),R.success("创建成功")),E.value=!1,u()}catch(n){console.error("提交失败:",n)}},Y=async()=>{try{await C.value.validate(),await w({url:"/region/batch",method:"post",data:d}),R.success("批量创建成功"),U.value=!1,u()}catch(n){console.error("批量提交失败:",n),R.error("批量创建失败")}},Z=()=>{Object.assign(y,{id:null,name:"",level:1,parentId:null,description:"",status:1}),j.value=[],I.value&&I.value.resetFields()},G=()=>{Object.assign(d,{regionName:"",countryName:"",provinceName:"",cityName:"",status:1}),m.value=[],h.value=[],c.value=[],N.value=[],C.value&&C.value.resetFields()},$=n=>{_.size=n,u()},ee=n=>{_.current=n,u()};return ae(()=>{u()}),{loading:i,tableData:e,pagination:_,batchDialogVisible:U,batchFormRef:C,batchForm:d,batchRules:P,regionOptions:m,countryOptions:h,provinceOptions:c,cityOptions:N,filteredCountryOptions:H,filteredProvinceOptions:J,filteredCityOptions:K,loadData:u,handleBatchAdd:M,handleEdit:Q,handleDelete:W,handleSubmit:X,handleBatchSubmit:Y,resetForm:Z,resetBatchForm:G,handleSizeChange:$,handleCurrentChange:ee,getLevelType:g,getLevelText:b,loadAllOptions:B,handleRegionChange:T,handleCountryChange:x,handleProvinceChange:l,handleCityChange:A}}},se={class:"region-page"},ue={class:"table-operations"},me={class:"pagination"},ce={class:"dialog-footer"},pe={class:"dialog-footer"};function fe(i,e,E,t,I,j){const U=s("Plus"),C=s("el-icon"),m=s("el-button"),h=s("Refresh"),c=s("el-table-column"),N=s("el-tag"),_=s("el-table"),y=s("el-pagination"),d=s("el-card"),P=s("el-input"),g=s("el-form-item"),b=s("el-option"),u=s("el-select"),O=s("el-radio"),B=s("el-radio-group"),M=s("el-form"),T=s("el-dialog"),x=te("loading");return p(),z("div",se,[e[28]||(e[28]=F("div",{class:"page-header"},[F("h2",{class:"page-title"},"地域管理"),F("p",{class:"page-description"},"管理片区、国家、省份、城市等地域信息")],-1)),a(d,null,{default:o(()=>[F("div",ue,[a(m,{type:"primary",onClick:t.handleBatchAdd},{default:o(()=>[a(C,null,{default:o(()=>[a(U)]),_:1}),e[16]||(e[16]=f(" 批量录入地域 ",-1))]),_:1,__:[16]},8,["onClick"]),a(m,{onClick:t.loadData},{default:o(()=>[a(C,null,{default:o(()=>[a(h)]),_:1}),e[17]||(e[17]=f(" 刷新 ",-1))]),_:1,__:[17]},8,["onClick"])]),ne((p(),k(_,{data:t.tableData,style:{width:"100%"}},{default:o(()=>[a(c,{prop:"regionName",label:"地域",width:"120"}),a(c,{prop:"countryName",label:"国家",width:"150"}),a(c,{prop:"provinceName",label:"省份",width:"120"}),a(c,{prop:"cityName",label:"城市",width:"120"}),a(c,{prop:"status",label:"状态",width:"100"},{default:o(l=>[a(N,{type:l.row.status===1?"success":"danger"},{default:o(()=>[f(re(l.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"操作",width:"200",fixed:"right"},{default:o(l=>[a(m,{type:"primary",size:"small",onClick:A=>t.handleEdit(l.row)},{default:o(()=>e[18]||(e[18]=[f(" 编辑 ",-1)])),_:2,__:[18]},1032,["onClick"]),a(m,{type:"danger",size:"small",onClick:A=>t.handleDelete(l.row)},{default:o(()=>e[19]||(e[19]=[f(" 删除 ",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,t.loading]]),F("div",me,[a(y,{"current-page":t.pagination.current,"onUpdate:currentPage":e[0]||(e[0]=l=>t.pagination.current=l),"page-size":t.pagination.size,"onUpdate:pageSize":e[1]||(e[1]=l=>t.pagination.size=l),"page-sizes":[10,20,50,100],total:t.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange,"hide-on-single-page":!1},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),a(T,{modelValue:i.dialogVisible,"onUpdate:modelValue":e[8]||(e[8]=l=>i.dialogVisible=l),title:i.dialogTitle,width:"500px",onClose:t.resetForm},{footer:o(()=>[F("span",ce,[a(m,{onClick:e[7]||(e[7]=l=>i.dialogVisible=!1)},{default:o(()=>e[22]||(e[22]=[f("取消",-1)])),_:1,__:[22]}),a(m,{type:"primary",onClick:t.handleSubmit},{default:o(()=>e[23]||(e[23]=[f("确定",-1)])),_:1,__:[23]},8,["onClick"])])]),default:o(()=>[a(M,{ref:"formRef",model:i.form,rules:i.rules,"label-width":"100px"},{default:o(()=>[a(g,{label:"地域名称",prop:"name"},{default:o(()=>[a(P,{modelValue:i.form.name,"onUpdate:modelValue":e[2]||(e[2]=l=>i.form.name=l),placeholder:"请输入地域名称"},null,8,["modelValue"])]),_:1}),a(g,{label:"层级",prop:"level"},{default:o(()=>[a(u,{modelValue:i.form.level,"onUpdate:modelValue":e[3]||(e[3]=l=>i.form.level=l),placeholder:"请选择层级",style:{width:"100%"}},{default:o(()=>[a(b,{label:"片区",value:1}),a(b,{label:"国家",value:2}),a(b,{label:"省份",value:3}),a(b,{label:"城市",value:4})]),_:1},8,["modelValue"])]),_:1}),i.form.level>1?(p(),k(g,{key:0,label:"上级地域",prop:"parentId"},{default:o(()=>[a(u,{modelValue:i.form.parentId,"onUpdate:modelValue":e[4]||(e[4]=l=>i.form.parentId=l),placeholder:"请选择上级地域",style:{width:"100%"}},{default:o(()=>[(p(!0),z(D,null,S(i.parentOptions,l=>(p(),k(b,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):ie("",!0),a(g,{label:"描述",prop:"description"},{default:o(()=>[a(P,{modelValue:i.form.description,"onUpdate:modelValue":e[5]||(e[5]=l=>i.form.description=l),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),a(g,{label:"状态",prop:"status"},{default:o(()=>[a(B,{modelValue:i.form.status,"onUpdate:modelValue":e[6]||(e[6]=l=>i.form.status=l)},{default:o(()=>[a(O,{label:1},{default:o(()=>e[20]||(e[20]=[f("启用",-1)])),_:1,__:[20]}),a(O,{label:0},{default:o(()=>e[21]||(e[21]=[f("禁用",-1)])),_:1,__:[21]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"]),a(T,{modelValue:t.batchDialogVisible,"onUpdate:modelValue":e[15]||(e[15]=l=>t.batchDialogVisible=l),title:"批量录入地域信息",width:"600px",onClose:t.resetBatchForm},{footer:o(()=>[F("span",pe,[a(m,{onClick:e[14]||(e[14]=l=>t.batchDialogVisible=!1)},{default:o(()=>e[26]||(e[26]=[f("取消",-1)])),_:1,__:[26]}),a(m,{type:"primary",onClick:t.handleBatchSubmit},{default:o(()=>e[27]||(e[27]=[f("确定",-1)])),_:1,__:[27]},8,["onClick"])])]),default:o(()=>[a(M,{ref:"batchFormRef",model:t.batchForm,rules:t.batchRules,"label-width":"120px"},{default:o(()=>[a(g,{label:"地域名称",prop:"regionName"},{default:o(()=>[a(u,{modelValue:t.batchForm.regionName,"onUpdate:modelValue":e[9]||(e[9]=l=>t.batchForm.regionName=l),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入地域名称（如：中国、亚太区）",style:{width:"100%"},onChange:t.handleRegionChange},{default:o(()=>[(p(!0),z(D,null,S(t.regionOptions,l=>(p(),k(b,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),a(g,{label:"国家名称",prop:"countryName"},{default:o(()=>[a(u,{modelValue:t.batchForm.countryName,"onUpdate:modelValue":e[10]||(e[10]=l=>t.batchForm.countryName=l),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入国家名称",style:{width:"100%"},onChange:t.handleCountryChange,disabled:!t.batchForm.regionName},{default:o(()=>[(p(!0),z(D,null,S(t.filteredCountryOptions,l=>(p(),k(b,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),a(g,{label:"省份名称",prop:"provinceName"},{default:o(()=>[a(u,{modelValue:t.batchForm.provinceName,"onUpdate:modelValue":e[11]||(e[11]=l=>t.batchForm.provinceName=l),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入省份名称（可选）",style:{width:"100%"},onChange:t.handleProvinceChange,disabled:!t.batchForm.countryName},{default:o(()=>[(p(!0),z(D,null,S(t.filteredProvinceOptions,l=>(p(),k(b,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),a(g,{label:"城市名称",prop:"cityName"},{default:o(()=>[a(u,{modelValue:t.batchForm.cityName,"onUpdate:modelValue":e[12]||(e[12]=l=>t.batchForm.cityName=l),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入城市名称（可选）",style:{width:"100%"},onChange:t.handleCityChange,disabled:!t.batchForm.provinceName},{default:o(()=>[(p(!0),z(D,null,S(t.filteredCityOptions,l=>(p(),k(b,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1}),a(g,{label:"状态",prop:"status"},{default:o(()=>[a(B,{modelValue:t.batchForm.status,"onUpdate:modelValue":e[13]||(e[13]=l=>t.batchForm.status=l)},{default:o(()=>[a(O,{label:1},{default:o(()=>e[24]||(e[24]=[f("启用",-1)])),_:1,__:[24]}),a(O,{label:0},{default:o(()=>e[25]||(e[25]=[f("禁用",-1)])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"])])}const be=le(de,[["render",fe],["__scopeId","data-v-6d81cafc"]]);export{be as default};
