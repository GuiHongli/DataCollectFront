import{s as C}from"./request-a0feafd1.js";import{_ as F,r as f,g as D,o as R,a as r,i as j,b as V,c as S,d as p,e as o,w as n,E as N,j as h,f as g,k as O,l as B,F as q,m as M,t as L}from"./index-523b1615.js";const G={name:"Executor",setup(){const x=f(!1),e=f([]),b=f(!1),l=f(""),v=f(),z=f([]),s=D({current:1,size:10,total:0}),i=D({id:null,name:"",ipAddress:"",regionId:null,description:""}),d={name:[{required:!0,message:"请输入执行机名称",trigger:"blur"}],ipAddress:[{required:!0,message:"请输入IP地址",trigger:"blur"}],regionId:[{required:!0,message:"请选择所属地域",trigger:"change"}]},c=async()=>{x.value=!0;try{const t={current:s.current,size:s.size},_=await C({url:"/executor/page",method:"get",params:t});e.value=_.data.records,s.total=_.data.total}catch(t){console.error("加载数据失败:",t)}finally{x.value=!1}},u=async()=>{try{const t=await C({url:"/executor/region-options",method:"get"});z.value=t.data}catch(t){console.error("加载地域数据失败:",t)}},k=()=>{l.value="新增执行机",b.value=!0,m()},w=t=>{l.value="编辑执行机",i.id=t.id,i.name=t.name,i.ipAddress=t.ipAddress,i.regionId=t.regionId,i.description=t.description,b.value=!0},I=async t=>{try{await N.confirm("确定要删除这个执行机吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C({url:`/executor/${t.id}`,method:"delete"}),h.success("删除成功"),c()}catch(_){_!=="cancel"&&h.error("删除失败")}},y=async()=>{try{await v.value.validate(),i.id?(await C({url:`/executor/${i.id}`,method:"put",data:i}),h.success("更新成功")):(await C({url:"/executor",method:"post",data:i}),h.success("创建成功")),b.value=!1,c()}catch(t){console.error("提交失败:",t)}},m=()=>{Object.assign(i,{id:null,name:"",ipAddress:"",regionId:null,description:""}),v.value&&v.value.resetFields()},A=t=>{s.size=t,c()},P=t=>{s.current=t,c()};return R(()=>{c(),u()}),{loading:x,tableData:e,pagination:s,dialogVisible:b,dialogTitle:l,formRef:v,form:i,rules:d,regionOptions:z,loadData:c,handleAdd:k,handleEdit:w,handleDelete:I,handleSubmit:y,resetForm:m,handleSizeChange:A,handleCurrentChange:P}}},H={class:"executor-page"},J={class:"table-operations"},K={class:"pagination"},Q={style:{display:"flex","justify-content":"space-between","align-items":"center"}},W={class:"dialog-footer"};function X(x,e,b,l,v,z){const s=r("Plus"),i=r("el-icon"),d=r("el-button"),c=r("Refresh"),u=r("el-table-column"),k=r("el-table"),w=r("el-pagination"),I=r("el-card"),y=r("el-input"),m=r("el-form-item"),A=r("el-tag"),P=r("el-option"),t=r("el-select"),_=r("el-form"),E=r("el-dialog"),U=j("loading");return V(),S("div",H,[e[15]||(e[15]=p("div",{class:"page-header"},[p("h2",{class:"page-title"},"执行机管理"),p("p",{class:"page-description"},"管理执行机信息，包括IP地址、所属地域等")],-1)),o(I,null,{default:n(()=>[p("div",J,[o(d,{type:"primary",onClick:l.handleAdd},{default:n(()=>[o(i,null,{default:n(()=>[o(s)]),_:1}),e[8]||(e[8]=g(" 新增执行机 ",-1))]),_:1,__:[8]},8,["onClick"]),o(d,{onClick:l.loadData},{default:n(()=>[o(i,null,{default:n(()=>[o(c)]),_:1}),e[9]||(e[9]=g(" 刷新 ",-1))]),_:1,__:[9]},8,["onClick"])]),O((V(),B(k,{data:l.tableData,style:{width:"100%"}},{default:n(()=>[o(u,{prop:"name",label:"执行机名称"}),o(u,{prop:"ipAddress",label:"IP地址"}),o(u,{prop:"regionName",label:"所属地域"}),o(u,{prop:"description",label:"描述"}),o(u,{prop:"createTime",label:"创建时间"}),o(u,{label:"操作",width:"200"},{default:n(a=>[o(d,{size:"small",onClick:T=>l.handleEdit(a.row)},{default:n(()=>e[10]||(e[10]=[g("编辑",-1)])),_:2,__:[10]},1032,["onClick"]),o(d,{size:"small",type:"danger",onClick:T=>l.handleDelete(a.row)},{default:n(()=>e[11]||(e[11]=[g("删除",-1)])),_:2,__:[11]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,l.loading]]),p("div",K,[o(w,{"current-page":l.pagination.current,"onUpdate:currentPage":e[0]||(e[0]=a=>l.pagination.current=a),"page-size":l.pagination.size,"onUpdate:pageSize":e[1]||(e[1]=a=>l.pagination.size=a),"page-sizes":[10,20,50,100],total:l.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),o(E,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[7]||(e[7]=a=>l.dialogVisible=a),title:l.dialogTitle,width:"500px",onClose:l.resetForm},{footer:n(()=>[p("span",W,[o(d,{onClick:e[6]||(e[6]=a=>l.dialogVisible=!1)},{default:n(()=>e[13]||(e[13]=[g("取消",-1)])),_:1,__:[13]}),o(d,{type:"primary",onClick:l.handleSubmit},{default:n(()=>e[14]||(e[14]=[g("确定",-1)])),_:1,__:[14]},8,["onClick"])])]),default:n(()=>[o(_,{ref:"formRef",model:l.form,rules:l.rules,"label-width":"100px"},{default:n(()=>[o(m,{label:"执行机名称",prop:"name"},{default:n(()=>[o(y,{modelValue:l.form.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.form.name=a),placeholder:"请输入执行机名称"},null,8,["modelValue"])]),_:1}),o(m,{label:"IP地址",prop:"ipAddress"},{default:n(()=>[o(y,{modelValue:l.form.ipAddress,"onUpdate:modelValue":e[3]||(e[3]=a=>l.form.ipAddress=a),placeholder:"请输入IP地址"},null,8,["modelValue"])]),_:1}),o(m,{label:"所属地域",prop:"regionId"},{default:n(()=>[o(t,{modelValue:l.form.regionId,"onUpdate:modelValue":e[4]||(e[4]=a=>l.form.regionId=a),placeholder:"请选择所属城市",style:{width:"100%"},filterable:"",clearable:""},{default:n(()=>[(V(!0),S(q,null,M(l.regionOptions,a=>(V(),B(P,{key:a.id,label:a.fullPath,value:a.id},{default:n(()=>[p("div",Q,[p("span",null,L(a.fullPath),1),o(A,{size:"small",type:"info"},{default:n(()=>e[12]||(e[12]=[g("城市",-1)])),_:1,__:[12]})])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"描述",prop:"description"},{default:n(()=>[o(y,{modelValue:l.form.description,"onUpdate:modelValue":e[5]||(e[5]=a=>l.form.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])])}const $=F(G,[["render",X],["__scopeId","data-v-812a4db5"]]);export{$ as default};
