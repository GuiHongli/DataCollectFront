import{s as k}from"./request-a0feafd1.js";import{_ as J,r as C,g as N,o as K,a as s,i as Q,b as i,c as m,d as r,e as l,w as a,E as W,j as z,f as u,k as X,l as F,t as b,n as x,F as O,m as j}from"./index-523b1615.js";const Y={name:"CollectStrategy",setup(){const V=C(!1),e=C([]),v=C(!1),o=C(""),y=C(),D=C([]),_=N({current:1,size:10,total:0}),d=N({id:null,name:"",collectCount:1,testCaseSetId:null,description:"",status:1}),p={name:[{required:!0,message:"请输入策略名称",trigger:"blur"}],collectCount:[{required:!0,message:"请输入采集次数",trigger:"blur"}],testCaseSetId:[{required:!0,message:"请选择用例集",trigger:"change"}]},f=async()=>{V.value=!0;try{const n={current:_.current,size:_.size},g=await k({url:"/collect-strategy/page",method:"get",params:n});e.value=g.data.records,_.total=g.data.total}catch(n){console.error("加载数据失败:",n)}finally{V.value=!1}},c=async()=>{try{const n=await k({url:"/test-case-set/list",method:"get"});D.value=n.data}catch(n){console.error("加载用例集数据失败:",n)}},U=()=>{o.value="新增策略",v.value=!0,S()},B=n=>{o.value="编辑策略",Object.assign(d,n),v.value=!0},I=async n=>{try{await W.confirm("确定要删除这个策略吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k({url:`/collect-strategy/${n.id}`,method:"delete"}),z.success("删除成功"),f()}catch(g){g!=="cancel"&&z.error("删除失败")}},L=async()=>{try{await y.value.validate(),d.id?(await k({url:`/collect-strategy/${d.id}`,method:"put",data:d}),z.success("更新成功")):(await k({url:"/collect-strategy",method:"post",data:d}),z.success("创建成功")),v.value=!1,f()}catch(n){console.error("提交失败:",n)}},S=()=>{Object.assign(d,{id:null,name:"",collectCount:1,testCaseSetId:null,description:"",status:1}),y.value&&y.value.resetFields()},T=n=>{_.size=n,f()},h=n=>{_.current=n,f()};return K(()=>{f(),c()}),{loading:V,tableData:e,pagination:_,dialogVisible:v,dialogTitle:o,formRef:y,form:d,rules:p,testCaseSetOptions:D,loadData:f,loadTestCaseSetOptions:c,handleAdd:U,handleEdit:B,handleDelete:I,handleSubmit:L,resetForm:S,handleSizeChange:T,handleCurrentChange:h}}},Z={class:"collect-strategy-page"},$={class:"table-operations"},ee={key:0},te={class:"test-case-set-info"},le={class:"set-name"},oe={key:0,class:"set-description"},ae={key:1,class:"test-case-info"},ne={key:0},se={key:2,class:"file-info"},re={key:1,style:{color:"#909399"}},ie={class:"pagination"},de={class:"dialog-footer"};function ue(V,e,v,o,y,D){const _=s("Plus"),d=s("el-icon"),p=s("el-button"),f=s("Refresh"),c=s("el-table-column"),U=s("Link"),B=s("el-link"),I=s("el-tag"),L=s("el-table"),S=s("el-pagination"),T=s("el-card"),h=s("el-input"),n=s("el-form-item"),g=s("el-input-number"),R=s("el-option"),q=s("el-select"),E=s("el-radio"),M=s("el-radio-group"),P=s("el-form"),A=s("el-dialog"),G=Q("loading");return i(),m("div",Z,[e[21]||(e[21]=r("div",{class:"page-header"},[r("h2",{class:"page-title"},"采集策略管理"),r("p",{class:"page-description"},"管理采集策略，包括策略名称、采集次数、逻辑环境等")],-1)),l(T,null,{default:a(()=>[r("div",$,[l(p,{type:"primary",onClick:o.handleAdd},{default:a(()=>[l(d,null,{default:a(()=>[l(_)]),_:1}),e[9]||(e[9]=u(" 新增策略 ",-1))]),_:1,__:[9]},8,["onClick"]),l(p,{onClick:o.loadData},{default:a(()=>[l(d,null,{default:a(()=>[l(f)]),_:1}),e[10]||(e[10]=u(" 刷新 ",-1))]),_:1,__:[10]},8,["onClick"])]),X((i(),F(L,{data:o.tableData,style:{width:"100%"}},{default:a(()=>[l(c,{prop:"name",label:"策略名称"}),l(c,{prop:"collectCount",label:"采集次数"}),l(c,{label:"用例集","min-width":"300"},{default:a(t=>[t.row.testCaseSetName?(i(),m("div",ee,[r("div",te,[r("div",le,[r("strong",null,b(t.row.testCaseSetName)+" ("+b(t.row.testCaseSetVersion)+")",1)]),t.row.testCaseSetDescription?(i(),m("div",oe,[e[11]||(e[11]=r("span",{class:"label"},"描述：",-1)),r("span",null,b(t.row.testCaseSetDescription),1)])):x("",!0),t.row.testCaseList&&t.row.testCaseList.length>0?(i(),m("div",ae,[e[12]||(e[12]=r("span",{class:"label"},"测试用例：",-1)),(i(!0),m(O,null,j(t.row.testCaseList,(w,H)=>(i(),m("span",{key:w.id},[u(b(w.name)+"("+b(w.number)+") ",1),H<t.row.testCaseList.length-1?(i(),m("span",ne,", ")):x("",!0)]))),128))])):x("",!0),t.row.testCaseSetGohttpserverUrl?(i(),m("div",se,[e[14]||(e[14]=r("span",{class:"label"},"文件：",-1)),l(B,{type:"primary",href:t.row.testCaseSetGohttpserverUrl,target:"_blank",underline:!1},{default:a(()=>[l(d,null,{default:a(()=>[l(U)]),_:1}),e[13]||(e[13]=u(" 查看文件 ",-1))]),_:2,__:[13]},1032,["href"])])):x("",!0)])])):(i(),m("span",re,"未配置"))]),_:1}),l(c,{prop:"description",label:"描述"}),l(c,{prop:"status",label:"状态"},{default:a(t=>[l(I,{type:t.row.status===1?"success":"danger"},{default:a(()=>[u(b(t.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"createTime",label:"创建时间"}),l(c,{label:"操作",width:"200"},{default:a(t=>[l(p,{size:"small",onClick:w=>o.handleEdit(t.row)},{default:a(()=>e[15]||(e[15]=[u("编辑",-1)])),_:2,__:[15]},1032,["onClick"]),l(p,{size:"small",type:"danger",onClick:w=>o.handleDelete(t.row)},{default:a(()=>e[16]||(e[16]=[u("删除",-1)])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,o.loading]]),r("div",ie,[l(S,{"current-page":o.pagination.current,"onUpdate:currentPage":e[0]||(e[0]=t=>o.pagination.current=t),"page-size":o.pagination.size,"onUpdate:pageSize":e[1]||(e[1]=t=>o.pagination.size=t),"page-sizes":[10,20,50,100],total:o.pagination.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1}),l(A,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[8]||(e[8]=t=>o.dialogVisible=t),title:o.dialogTitle,width:"500px",onClose:o.resetForm},{footer:a(()=>[r("span",de,[l(p,{onClick:e[7]||(e[7]=t=>o.dialogVisible=!1)},{default:a(()=>e[19]||(e[19]=[u("取消",-1)])),_:1,__:[19]}),l(p,{type:"primary",onClick:o.handleSubmit},{default:a(()=>e[20]||(e[20]=[u("确定",-1)])),_:1,__:[20]},8,["onClick"])])]),default:a(()=>[l(P,{ref:"formRef",model:o.form,rules:o.rules,"label-width":"120px"},{default:a(()=>[l(n,{label:"策略名称",prop:"name"},{default:a(()=>[l(h,{modelValue:o.form.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.name=t),placeholder:"请输入策略名称"},null,8,["modelValue"])]),_:1}),l(n,{label:"采集次数",prop:"collectCount"},{default:a(()=>[l(g,{modelValue:o.form.collectCount,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.collectCount=t),min:1,max:1e3,placeholder:"请输入采集次数",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{label:"用例集",prop:"testCaseSetId"},{default:a(()=>[l(q,{modelValue:o.form.testCaseSetId,"onUpdate:modelValue":e[4]||(e[4]=t=>o.form.testCaseSetId=t),placeholder:"请选择用例集",style:{width:"100%"}},{default:a(()=>[(i(!0),m(O,null,j(o.testCaseSetOptions,t=>(i(),F(R,{key:t.id,label:`${t.name} (${t.version})`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"描述",prop:"description"},{default:a(()=>[l(h,{modelValue:o.form.description,"onUpdate:modelValue":e[5]||(e[5]=t=>o.form.description=t),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(n,{label:"状态",prop:"status"},{default:a(()=>[l(M,{modelValue:o.form.status,"onUpdate:modelValue":e[6]||(e[6]=t=>o.form.status=t)},{default:a(()=>[l(E,{label:1},{default:a(()=>e[17]||(e[17]=[u("启用",-1)])),_:1,__:[17]}),l(E,{label:0},{default:a(()=>e[18]||(e[18]=[u("禁用",-1)])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])])}const _e=J(Y,[["render",ue],["__scopeId","data-v-bb4f344c"]]);export{_e as default};
