# 采集任务自定义参数编辑功能说明

## 功能概述

在"新建采集任务"页面中，当用户选择采集策略后，策略详情区域支持展示和编辑自定义参数列表。用户可以在创建任务时修改策略中配置的自定义参数，这些修改后的参数会作为任务的自定义参数保存。

## 功能特性

### 1. 自定义参数展示
- 在策略详情中以标签形式展示现有的自定义参数
- 显示格式：`参数名: 参数值`
- 当没有参数时显示"无参数"

### 2. 自定义参数编辑
- 提供"编辑"按钮，点击后进入编辑模式
- 编辑模式下可以：
  - 修改现有参数的key和value
  - 添加新的参数项
  - 删除不需要的参数项
  - 保存或取消编辑

### 3. 参数验证
- 过滤掉空的参数项（key或value为空）
- 检查参数名是否重复
- 确保至少有一个参数项用于编辑

### 4. 数据持久化
- 编辑后的自定义参数会保存到任务记录中
- 参数以JSON格式存储在数据库的`custom_params`字段中

## 技术实现

### 前端实现

#### 1. 响应式数据
```javascript
// 自定义参数相关
const showCustomParamsEditor = ref(false)
const editableCustomParams = ref([])
const originalCustomParams = ref([])
```

#### 2. 核心方法
- `initializeCustomParams()`: 初始化自定义参数
- `addCustomParam()`: 添加参数项
- `removeCustomParam(index)`: 删除参数项
- `saveCustomParams()`: 保存参数修改
- `cancelCustomParamsEdit()`: 取消编辑

#### 3. UI组件
- 使用`el-descriptions`展示策略详情
- 编辑模式使用`el-input`输入框
- 使用`el-button`进行添加、删除、保存、取消操作

### 后端实现

#### 1. 数据库变更
```sql
-- 为采集任务表添加自定义参数字段
ALTER TABLE collect_task ADD COLUMN custom_params TEXT COMMENT '自定义参数列表（JSON格式）';
```

#### 2. 实体类更新
- `CollectTask`实体类添加`customParams`字段
- `CollectTaskRequest`DTO添加`customParams`字段

#### 3. 服务层更新
- `CollectTaskServiceImpl.createCollectTask()`方法支持保存自定义参数

## 使用流程

1. 用户进入"新建采集任务"页面
2. 选择采集策略后，策略详情区域显示自定义参数
3. 点击"编辑"按钮进入编辑模式
4. 修改、添加或删除参数项
5. 点击"保存"按钮保存修改，或点击"取消"按钮放弃修改
6. 创建任务时，修改后的自定义参数会随任务一起保存

## 样式设计

### 自定义参数区域样式
```css
.custom-params-section {
  width: 100%;
}

.custom-params-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.custom-params-editor {
  border: 1px solid #e4e7ed;
  border-radius: 4px;
  padding: 12px;
  background-color: #fafafa;
}

.param-item {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}
```

## 注意事项

1. 自定义参数的修改只影响当前任务，不会修改原始策略的配置
2. 参数名不能重复，系统会进行验证
3. 空的参数项会被自动过滤掉
4. 编辑模式下的修改在保存前不会影响原始数据
5. 取消编辑会恢复到原始参数状态

## 扩展性

该功能设计具有良好的扩展性：
- 可以轻松添加更多的参数验证规则
- 支持不同类型的参数值（如数字、布尔值等）
- 可以扩展为支持参数模板功能
- 可以添加参数导入/导出功能
